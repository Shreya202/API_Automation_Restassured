pipeline {

    agent any

    tools {
        maven 'Maven'      // Name configured in Jenkins Global Tool Configuration
        jdk 'JDK17'        // Name configured in Jenkins
    }

    environment {
        BASE_URL = 'https://reqres.in/api'
    }

    stages {

        stage('Checkout Code') {
            steps {
                checkout scm
            }
        }

        stage('Clean Workspace') {
            steps {
                sh 'mvn clean'
            }
        }

        stage('Build & Run Tests') {
            steps {
                sh "mvn test -DbaseUrl=${BASE_URL}"
            }
        }

        stage('Publish Test Results') {
            steps {
                junit 'target/surefire-reports/*.xml'
            }
        }

        stage('Archive Extent Report') {
            steps {
                archiveArtifacts artifacts: 'target/ExtentReport*.html', fingerprint: true
            }
        }
    }

    post {

        always {
            echo 'Pipeline execution completed.'
        }

        success {
            echo 'Build SUCCESS ✅'
        }

        failure {
            echo 'Build FAILED ❌'
        }
    }
}